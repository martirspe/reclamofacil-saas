<header class="header">
  <button class="header-mobile-menu" type="button" (click)="sidebarToggle.emit()" aria-label="Abrir menú de navegación"
    aria-controls="sidebar" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
      stroke-linejoin="round" role="presentation">
      <line x1="3" y1="6" x2="21" y2="6" />
      <line x1="3" y1="12" x2="21" y2="12" />
      <line x1="3" y1="18" x2="21" y2="18" />
    </svg>
  </button>

  <nav class="header-breadcrumbs" aria-label="Navegación de ruta">
    <button
      class="header-sidebar-toggle"
      type="button"
      (click)="toggleSidebarCollapse.emit()"
      [attr.aria-label]="isSidebarCollapsed() ? 'Expandir sidebar' : 'Contraer sidebar'">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round" role="presentation">
        @if (isSidebarCollapsed()) {
          <polyline points="9 18 15 12 9 6" />
        } @else {
          <polyline points="15 18 9 12 15 6" />
        }
      </svg>
    </button>
    <ol class="breadcrumbs">
      <li class="breadcrumbs-item">
        <a class="breadcrumbs-link" routerLink="/dashboard">Dashboard</a>
      </li>
      <li class="breadcrumbs-separator" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round" role="presentation">
          <polyline points="9 18 15 12 9 6" />
        </svg>
      </li>
      <li class="breadcrumbs-item">
        <span class="breadcrumbs-current" aria-current="page">Reclamos</span>
      </li>
    </ol>
  </nav>

  <section class="header-actions" aria-label="Acciones rápidas">
    <form class="header-search" role="search" (submit)="$event.preventDefault()">
      <label class="header-search-label" for="global-search">
        <svg class="header-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" role="presentation">
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <span class="sr-only">Buscar</span>
      </label>
      <input id="global-search" name="q" class="header-search-input" type="search" placeholder="Buscar..." />
      <kbd class="header-search-kbd" aria-hidden="true">Ctrl K</kbd>
    </form>

    <button
      class="header-notifications"
      type="button"
      #notificationsButton
      (click)="toggleNotifications()"
      [attr.aria-expanded]="isNotificationsOpen()"
      aria-haspopup="dialog"
      aria-controls="notifications-panel"
      [attr.aria-label]="unreadCount() ? 'Notificaciones: ' + unreadCount() + ' sin leer' : 'Notificaciones'">
      <svg class="header-notifications-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" role="presentation">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
        <path d="M13.73 21a2 2 0 0 1-3.46 0" />
      </svg>
      @if (unreadCount()) {
        <span class="header-notifications-badge" aria-hidden="true">{{ unreadCount() }}</span>
      }
    </button>

    @if (isNotificationsOpen()) {
      <section
        id="notifications-panel"
        #notificationsPanel
        class="header-notifications-panel"
        role="dialog"
        aria-labelledby="notifications-title">
        <header class="header-notifications-panel-header">
          <h2 id="notifications-title" class="header-notifications-title">Notificaciones</h2>
          <div class="header-notifications-actions">
            <button class="header-notifications-action" type="button" (click)="markAllAsRead()" aria-label="Marcar todo como leído">
              <svg class="header-notifications-action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="presentation">
                <polyline points="20 6 9 17 4 12" />
                <polyline points="20 12 14 18 11 15" />
              </svg>
              <span class="sr-only">Marcar todo como leído</span>
            </button>
            <button class="header-notifications-action" type="button" (click)="closeNotifications()" aria-label="Cerrar notificaciones">
              <svg class="header-notifications-action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="presentation">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
              <span class="sr-only">Cerrar</span>
            </button>
          </div>
        </header>
        @if (notifications().length === 0) {
          <p class="header-notifications-empty">Sin notificaciones nuevas.</p>
        } @else {
          <ul class="header-notifications-list" role="list">
            @for (notification of notifications(); track notification.id) {
              <li class="header-notifications-item">
                <button
                  class="header-notification-card"
                  type="button"
                  (click)="markAsRead(notification.id)"
                  [class.is-unread]="notification.unread">
                  <span class="header-notification-indicator" [attr.data-type]="notification.type" aria-hidden="true"></span>
                  <span class="header-notification-content">
                    <span class="header-notification-title">{{ notification.title }}</span>
                    <span class="header-notification-description">{{ notification.description }}</span>
                  </span>
                  <time class="header-notification-time">{{ notification.time }}</time>
                </button>
              </li>
            }
          </ul>
        }
        @if (notificationsPagination().page < notificationsPagination().pages) {
          <button class="header-notifications-more" type="button" (click)="loadMoreNotifications()">
            Cargar más
          </button>
        }
      </section>
    }

    <button class="header-user" type="button" aria-label="Menu de cuenta"
      [attr.aria-expanded]="isUserMenuOpen()" aria-controls="header-user-dropdown" aria-haspopup="menu"
      (click)="toggleUserMenu()">
      <span class="header-user-avatar" role="img" [attr.aria-label]="'Avatar de ' + userName()">
        <span class="header-user-initial" aria-hidden="true">{{ userInitials() }}</span>
      </span>
    </button>

    @if (isUserMenuOpen()) {
    <div id="header-user-dropdown" class="header-user-dropdown">
      <app-user-dropdown class="user-dropdown--header" (closeDropdown)="closeUserMenu()" />
    </div>
    }
  </section>
</header>